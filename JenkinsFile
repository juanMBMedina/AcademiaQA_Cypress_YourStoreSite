pipeline {
    agent any
    
    environment {
        GIT_URL = 'git@github.com:juanMBMedina/AcademiaQA_Cypress_YourStoreSite.git'
		SONAR_EXCLUSIONS = "**/node_modules/**,**/dist/**"
    }

    stages {
        
        stage('Clone Repository') {
            steps {
                echo "Current directory: ${env.WORKSPACE}"
				echo "Cloning from: ${env.GIT_URL}"
                git branch: 'main', credentialsId: 'github-ssh-key', url: env.GIT_URL
            }
        }

        /*
		stage('SonarQube Analysis') {
			steps {
				script {
					echo "Getting SonarQube URL..."
					def sonar_ip = sh(script: "docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' sonarqube", returnStdout: true).trim()
					def sonar_host_url = "http://${sonar_ip}:9000"
					
					docker exec -it sonar-scanner sh cd /var/jenkins_home/workspace/TestPipeline && ls -la
					
					withCredentials([string(credentialsId: 'sonar-token', variable: 'SONAR_TOKEN')]) {
						sh "docker ps | grep sonar-scanner || docker start sonar-scanner"
						sh """
							docker run --rm \
							--network jenkins_default \
							-v ${env.WORKSPACE}:/workspace \
							sonar-scanner \
							sonar-scanner \
							-Dsonar.projectKey=${SONAR_PROYECT_KEY} \
							-Dsonar.sources=/workspace \
							-Dsonar.host.url=${sonar_host_url} \
							-Dsonar.login=${SONAR_TOKEN} \
							-Dsonar.exclusions=${SONAR_EXCLUSIONS}
						"""
					}
				}
			}
		}
        */
    }
}